const DETAILS={TIME_MALUS:1,PERIODES:4,DELIVERY:8,ABANDON:16},HIDE_UNAVAILABLE=2,DISPLAY_DETAILS=0,S_DEVISE="MAD";var currencies={},i18n={};(function(a){function t(e){var t=1/parseFloat(e.change[DEVISE]),n=1/parseFloat(e.change[S_DEVISE]),r=1==t?0:2;departureDate=a("#date1").val()+" "+a("#hour1").val(),arrivalDate=a("#date2").val()+" "+a("#hour2").val();var o=0;1==t?a(".mCUR").parent().hide():a(".mCUR").parent().show(),n==t?a(".sCUR").parent().hide():a(".sCUR").parent().show(),a(".noneAv").removeClass("hide"),a.each(e.cars,function(s,l){var c=0,d=0,p=1e7,u=0,h=a(".fiche[data-car='"+s+"']");if(a(h).find(".abandon").css("visibility","hidden"),a(h).find(".oldprice").text("").parent().hide(),a(h).removeClass("dispo"),l.unavailable||e.daysNumber>MAX_BK_DAYS)a(h).data("price",9999999999),a(h).find(".available,.abandon,.book-btn").addClass("hidden"),a(h).find(".prices").parent().addClass("hidden"),a(h).find(".totall,.total,.noneFranAmm,partFranAmm,fullFranAmm,.noneexcess-totalprice,.partexcess-totalprice,.fullexcess-totalprice").text("0000"),a(h).find(".not-available").removeClass("hidden"),a(".tabs").css("visibility","hidden"),a(h).find(".car-unavailable").removeClass("hidden"),HIDE_UNAVAILABLE&parseInt(l.unavailable)&&!a(h).hasClass("nohide")&&a(h).addClass("hidden"),e.txt.unavailable&&a(h).find(".not-available a,.car-unavailable span").text(e.txt.unavailable);else{a(".noneAv").addClass("hide"),a(".tabs").css("visibility","visible"),a(h).removeClass("hidden"),a(h).addClass("dispo"),a(h).find(".available,.abandon,.book-btn").removeClass("hidden"),a(h).find(".prices").parent().removeClass("hidden"),a(h).find(".not-available").addClass("hidden"),a(h).find(".car-unavailable").addClass("hidden"),c+=parseFloat(e.delivery.point1.cost),c+=parseFloat(e.delivery.point2.cost),o++,a(".cost-details").html(""),a.each(l.periodesDetails,function(e,n){if(n.specRate){var s=parseFloat(n.specRate.taux);s<0?(d+=parseInt(n.specRate.nbj)*s*parseFloat(n.cost),a(".cost-details").append('<div style="width:100%;color:orange;" class="pull-left"><span class="gris-fonce pull-left"><strong> PROMO '+Math.round(1e4*s)/100+'%</strong></span><span class="pull-right">'+Math.round(1e4*s)/100+"% x "+n.specRate.nbj+" x "+i(n.cost*t,r)+" "+DEVISE_SYM+"</span></div>")):n.cost=(1+s)*parseFloat(n.cost)}p>parseFloat(n.cost)&&(p=parseFloat(n.cost)),c+=parseInt(n.nbJours)*parseFloat(n.cost),u+=n.nbJours});var f=c,v=0,m=0,x=0,g=0,b=0;a(".extrasList").html(""),"extras"in e&&Object.keys(e.extras).length>0&&a.each(e.extras,function(e,n){var s=parseFloat(n.cost);nbPayable=parseInt(n.premierGratuit)?parseInt(n.nbr)-1:parseInt(n.nbr),perDay=parseInt(n.paiementParJour),s=nbPayable*(s<1?f*s:perDay?s*u:s),v+=s,a(".extrasList").append('<li class="extra-'+n.id+'"><i class="icon-check-circle"></i>'+n.nbr+"x"+n.title+"<span>"+i(s*t,r)+" "+DEVISE_SYM+"</span></li>")}),a(".malusList").html(""),e.officeTimeMalus&&(m=parseFloat(e.officeTimeMalus.depart),m>0&&DISPLAY_DETAILS&DETAILS.TIME_MALUS&&a(".malusList").append(`<li class='malus-depart'>${e.txt.officeTimeDepart}<span>`+i(m*t,r)+" "+DEVISE_SYM+"</span></li>"),x=parseFloat(e.officeTimeMalus.return),x>0&&DISPLAY_DETAILS&DETAILS.TIME_MALUS&&a(".malusList").append(`<li class="malus-return">${e.txt.officeTimeReturn}<span>`+i(x*t,r)+" "+DEVISE_SYM+"</span></li>"),DISPLAY_DETAILS&DETAILS.TIME_MALUS?v+=x+m:c+=x+m),e.ageMalus&&(g=parseFloat(e.ageMalus.minClientAgeMalus),g>0&&(g<1&&(g*=f),a(".malusList").append(`<li class="malus-age">${e.txt.clientAgeMalus}<span>`+i(g*t,r)+" "+DEVISE_SYM+"</span></li>"),v+=g)),e.lmbMalus&&(b=parseFloat(e.lmbMalus.lmbMalus),b>0&&(b<1&&(b*=f),DISPLAY_DETAILS&DETAILS.TIME_MALUS&&a(".malusList").append(`<li class="malus-lmb">${e.txt.lmbMalus}: -${e.lmbMalus.lmbDelay}H<span>`+i(b*t,r)+" "+DEVISE_SYM+"</span></li>"),v+=b)),a(h).find(".totalextra").text(i(v*t,r)+" "+DEVISE_SYM);var y=parseFloat(e.retourn.cost);c+=y;var C=a(h).data("category"),A=0,S=0;d<0&&(a(h).find(".oldprice").text(i((c+v)*t,r)).parent().show(),a(h).find(".oldprice.sCUR").text(i((c+v)*n,r)).parent().show(),a(h).find(".oldprice.mCUR").text(i(c+v,r)).parent().show()),c+=d,C&&e.excess[C]?(S=parseFloat(e.excess[C].franchise),a(h).find(".noneFranAmm").text(i(S*t)),a(h).find(".noneFranAmm.sCUR").text(i(S*n)),a(h).find(".noneFranAmm.mCUR").text(i(S)),a(h).find(".noneexcess-totalprice").text(i(Math.round((c+v)*t),0)),a(h).find(".noneexcess-totalprice.sCUR").text(i(Math.round((c+v)*n),0)),a(h).find(".noneexcess-totalprice.mCUR").text(i(Math.round(c+v),0)),parseFloat(e.excess[C].half)>0?(a(h).find(".plan.gold").removeClass("hidden"),a(h).find(".plan.gold2").addClass("hidden"),A=parseFloat(e.excess[C].half),S=parseFloat(e.excess[C].franchise_part),a(h).find(".partFranAmm").text(i(S*t)),a(h).find(".partexcess-totalprice").text(i(Math.round((c+v+A)*t),0)),a(h).find(".partexcess-totalprice.sCUR").text(i(Math.round((c+v+A)*n),0)),a(h).find(".partexcess-totalprice.mCUR").text(i(Math.round(c+v+A),0))):parseFloat(e.excess[C].full)>0?(a(h).find(".plan.gold").addClass("hidden"),a(h).find(".plan.gold2").removeClass("hidden"),A=parseFloat(e.excess[C].full),S=parseFloat(e.excess[C].franchise_full),a(h).find(".fullFranAmm").text(S+""),a(h).find(".fullexcess-totalprice").text(i(Math.round((c+v+A)*t),0)),a(h).find(".fullexcess-totalprice.sCUR").text(i(Math.round((c+v+A)*n),0)),a(h).find(".fullexcess-totalprice.mCUR").text(i(Math.round(c+v+A),0))):(a(h).find(".plan.gold").addClass("hidden"),a(h).find(".plan.gold2").addClass("hidden")),a(h).find("#excess").length>0&&"none"!=a(h).find("#excess").val()&&(c+=A)):(a(h).find(".fullexcess-totalprice").text("ERROR"),a(h).find(".totalprice").text("ERROR"),a(h).data("price",999999999)),a(h).data("price",c);var I=c/u;a(h).find(".dayprice").text(i(I*t,0)),a(h).find(".dayprice.sCUR").text(i(I*n,0)),a(h).find(".dayprice.mCUR").text(i(I,0)),a(h).find(".days,#days").text(e.daysNumber+" "),c+=v,y&&(a(h).find(".abandon").css("visibility","visible"),a(h).find(".aOffice").text(e.retourn.city2),a(h).find(".retourn").text(i(y*t,0)),a(h).find(".retourn.sCUR").text(i(y*n,0)),a(h).find(".retourn.mCUR").text(i(y,0))),a(h).find(".total").text(i(c*t,r)),a(h).find(".total.sCUR").text(i(c*n,r)),a(h).find(".total.mCUR").text(i(c,r)),a(".totall").text(i(Math.round(c*t),0)),a(".totall.sCUR").text(i(Math.round(c*n),0)),a(".totall.mCUR").text("≈ "+i(Math.round(c),0)),currencies.mainCurrency==DEVISE?a(".mCUR").parent().hide():a(".mCUR").parent().show()}}),a("#askQuote").length&&e.daysNumber>MAX_BK_DAYS&&a("#askQuote").modal("show"),setTimeout(function(){s(a(".sort option:selected").val())},1e3),a(".nbRes").text("("+o+" )")}function n(){if(a("#date1").length){a(".loader").show();var e=new Array,n=new Array,i=a("#date1").val(),s=a("#date2").val();i.match(/^\d{4}-\d{2}-\d{2}$/)||(d=i.split("/"),i=d[2]+"-"+d[1]+"-"+d[0]),s.match(/^\d{4}-\d{2}-\d{2}$/)||(d=s.split("/"),s=d[2]+"-"+d[1]+"-"+d[0]),e=a(".extra").map(function(){if(parseInt(a(this).val()))return a(this).data("extra")}).get(),n=a(".extra").map(function(){if(parseInt(a(this).val()))return a(this).val()}).get();var r=a(".fiche").map(function(){return a(this).data("car")}).get();a.ajax({type:"POST",url:"./LocaSmartAPI/rememberData.php?_="+(new Date).getTime(),dataType:"json",cache:!1,async:!0,data:{date1:i,date2:s,hour1:a("#hour1").val(),hour2:a("#hour2").val(),city1:a("#point1 option:selected").data("city")?a("#point1 option:selected").data("city"):a("#city1").val(),city2:a("#point2 option:selected").data("city")?a("#point2 option:selected").data("city"):a("#city2").val(),point1:a("#point1").val(),point2:a("#point2").val()}}),r.length<=0?a(".loader").hide():a.ajax({type:"POST",url:LS_URL+"getCosts.json?_="+(new Date).getTime(),dataType:"json",cache:!1,async:!0,data:{modelId:r,clientLang:LANG,lang:LANG,account:ACCOUNT,devise:DEVISE,clientAge:a("#cage").val()?a("#cage").val():"0",date1:i,date2:s,hour1:a("#hour1").val(),hour2:a("#hour2").val(),city1:a("#point1 option:selected").data("city")?a("#point1 option:selected").data("city"):a("#city1").val(),city2:a("#point2 option:selected").data("city")?a("#point2 option:selected").data("city"):a("#city2").val(),station1:a("#point1").val(),station2:a("#point2").val(),extras:e,extrasNb:n,codePromo:a("#codePromo").val()},success:function(e,n,i){e.error?console.error("Erreur: "+e.error):t(e),a(".loader").hide()},error:function(e,t,n){a(".loader").hide()},complete:function(e,t){a(".loader").hide()}})}}function i(e,a=0){return e.toFixed(a).replace(/\B(?=(\d{3})+(?!\d))/g," ")}function s(e="priceLtoH"){var t=a(document).find(".fiche:first").parent(),n=t.find(".fiche");"priceHtoL"==e?n.sort(function(e,t){return parseInt(a(t).data("price"))-parseInt(a(e).data("price"))}):"priceLtoH"==e&&n.sort(function(e,t){return parseInt(a(e).data("price"))-parseInt(a(t).data("price"))}),n.each(function(){t.append(this)})}function r(){var e=new Date,t="";e.setUTCFullYear(e.getUTCFullYear()-parseInt(a("#cage").val())),e.setUTCDate(1);for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz12345678901234567890@@@@@@@@____________++++++........",i=0;i<=12;i++){var s=Math.floor(Math.random()*n.length);t+=n.substring(s,s+1)}a.ajax({type:"POST",url:LS_URL+"addClient.json?_="+(new Date).getTime(),dataType:"json",cache:!1,async:!0,data:{lang:LANG,account:ACCOUNT,nom:a("#cnom").val(),prenom:a("#cprenom").val(),gender:a("#cgender").val(),courriel:a("#ccourriel").val(),telephone:(a("#cphoneCode").length?a("#cphoneCode").val():"")+a("#cphone").val(),dateOfBirth:e.toISOString().substring(0,10),passwd:t,adresse:a("#cadresse").val()+","+a("#ccity").val(),pays:a("#cpays").val()},beforeSend:function(e){a(".btnNext").attr("disabled","disabled"),a(".loader").show()},success:function(e,t,n){e.error?(l(e.error),a(".loader").hide(),a(".btnNext").removeAttr("disabled")):e.session&&o(e.session)},error:function(e,t,n){a(".btnNext").removeAttr("disabled")},complete:function(){}})}function o(e){var t=[],n=[];t=a(".extra").map(function(){if(parseInt(a(this).val()))return a(this).data("extra")}).get(),n=a(".extra").map(function(){if(parseInt(a(this).val()))return a(this).val()}).get();var i={lang:LANG,account:ACCOUNT,cltDetail:DISPLAY_DETAILS,modelId:a("#carId").val(),date1:a("#date1").val(),date2:a("#date2").val(),hour1:a("#hour1").val(),hour2:a("#hour2").val(),station1:a("#point1").val(),station2:a("#point2").val(),city1:a("#city1").val(),city2:a("#city2").val(),excess:a("#excess").val(),remarque:(a("#cflight").length?"Flight: "+a("#cflight").val()+"<br/>":"")+(a("#chotel").length?"Hôtel: "+a("#chotel").val()+"<br/>":"")+(a("#cremarque").length?a("#cremarque").val():""),bkSource:WS_URL,devise:DEVISE,clientAge:a("#cage").val(),codePromo:a("#promocode").val(),extras:t,extrasNb:n,prePayMode:a("#prePayMode").length?a("#prePayMode").val():"",cadresse:a("#cadresse").val()+","+(a("#ccity").length?a("#ccity").val()+", ":"")+(a("#cpays").length?a("#cpays").val():"")};a.ajax({type:"POST",url:LS_URL+"saveBooking.json?_="+(new Date).getTime(),dataType:"json",cache:!1,async:!0,data:i,beforeSend:function(t){a(".loader").show(),t.setRequestHeader("sessionToken",e),a(".btnNext").attr("disabled","disabled")},success:function(e,t,n){e.error?(l(e.error),a(".btnNext").removeAttr("disabled")):e.success&&(a(".tabs").hide(),a(".tabConfirm").show(),c(".tabConfirm"))},complete:function(){a(".loader").hide()}})}function l(e){a(".error").html(e).parents(".errors:first").show(),c(".errors"),setTimeout(function(){a(".errors").hide()},5e3)}function c(e,t=1e3){a([document.documentElement,document.body]).animate({scrollTop:a(e).offset().top},t)}a.getJSON(`./LocaSmartAPI/js/lang/i18n_${LANG}.json`,function(e){i18n=e}),a("#cage").on("change",n),a("#point1").on("change",function(){a("#point2").val(a(this).val()).change()}),a(".extra").on("change",function(){if(a("#aged")){if(!a("#aged").is(":checked"))return a("#aged").parent("div:first").addClass("invalid"),a("#aged").focus(),void setTimeout(function(){a("#aged").parent("div:first").removeClass("invalid")},5e3);n()}else n()}),a(".booking-check-box input, .booking-check-box label").on("click",function(){e=a(this).data("extra"),a("#extra_"+e).prop("checked",!a("#extra_"+e).prop("checked")),a("#extra_"+e).prop("checked")?a("select[name=nbExtra"+e+"]").val(1):a("select[name=nbExtra"+e+"]").val(0),n()}),a(".btnNext").on("click",function(){if("1"==a(this).data("step"))a(".tabs").hide(),a(".tabDriver").show(),c(".tabDriver",1e3),a(".breadcrumb").length&&(a(".breadcrumb").find("li").removeClass("active"),a(".breadcrumb").find("li").last().addClass("active"));else if("2"==a(this).data("step")){var e=!0;if(a("#booking_form input:invalid").each(function(){return"checkbox"!=a(this).prop("type")&&a(this).focus(),l(i18n.txtCheckData),e=!1,e}),a("#ccourriel").val()!=a("#ccourriel2").val())return a("#ccourriel2").focus(),l(i18n.txtCheckData),e=!1,e;if(a("#cage").length&&!a("#cage").val())return a("#cage").focus(),e=!1,e;if(a("#ccourriel").val().endsWith(".pl"))return a("#ccourriel").focus(),l(i18n.txtPLMailError),e=!1,!1;e&&r()}}),a.ajax({type:"POST",url:LS_URL+"getCurrencies.json?_="+(new Date).getTime(),dataType:"json",cache:!1,async:!0,data:{lang:LANG,account:ACCOUNT},success:function(e,a,t){e.error?l(e.error):(currencies=e,n())}}),a("#otherStation").on("change",function(){a(this).is(":checked")?a(".dropup-wrap").show():a(".dropup-wrap").hide()}),a("#date1").on("change",function(){a("#date2").prop("min",a(this).val()),a("#date2").val()<a("#date2").prop("min")&&a("#date2").val(a("#date2").prop("min"))}),a("#date2").on("change",function(){a("#date1").prop("max",a(this).val()),a("#date1").val()>a("#date1").prop("max")&&a("#date1").val(a("#date1").prop("max"))}),a("#hour1").on("change",function(){a("#hour2").val(a("#hour1").val())}),a("#point1").on("change",function(){a("#point2").val(a("#point1").val())}),a(".carDesc").hide(),$i=0;Math.max.apply(null,a(".fiche").map(function(){return a(this).innerHeight()}).get());a(".searchIn, .extra, #refreshpromo").on("click",function(e){return e.preventDefault(),n(),a(".car-list").length&&a("html,body").animate({scrollTop:a(".car-list").offset().top},2e3),!1}),a(".cs-extras-check, extras-check").on("click",function(e){a(this).is(":checked")||a(this).parents(".extras-item").find("select").val("0"),n()}),a(".extra").change(function(e){a(this).val()>0?a(this).parents(".extras-item").find(".cs-extras-check").prop("checked",!0):a(this).parents(".extras-item").find(".cs-extras-check").prop("checked",!1),n()}),a("input[name='aged']").on("change",function(){a(this).parent("div:first").toggleClass("invalid",!a("input[name='aged']").is(":checked")),a(".searchBtn, #refreshpromo").prop("disabled",!a("input[name='aged']").is(":checked"))}),a(".reserve-vehicle-btn").on("click",function(e){a("#idcar").val(a(this).data("id")),a("#excess").val(a(this).data("excess")),a("#idcar").parents("form:first").submit()}),a("#refresh").on("click",function(e){a(".past1").val(a(".cop1").val()),a(".tpast1").val(a(".tcop1").val()),a(".past2").val(a(".cop2").val()),a(".tpast2").val(a(".tcop2").val()),a("form#refreshForm").submit()}),a(".more").on("click",function(){var e=a(this).data("id");a('.carDesc[data-id="'+e+'"]').toggle(200)}),a(".conditions-tab").on("click",function(){a(".conditions-content").hide(),a("#"+a(this).data("city")).show()}),setTimeout(s,600),a(".sort").on("change",function(){s(a(".sort option:selected").val())}),0==a(".loader").length&&(a("body").append("<div class='loader'><div class='ring'><span></span></div></div>"),a(".loader").hide()),a("body").append("<link rel='stylesheet' href='./LocaSmartAPI/css/main.min.css' type='text/css' media='all'/>")})(jQuery);